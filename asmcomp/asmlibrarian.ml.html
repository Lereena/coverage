<html>
  <head>
    <title>Coverage report</title>
    <link rel="stylesheet" href="../coverage.css" />
    <meta charset="utf-8" />
  </head>
  <body>
    <div id="header">
      <h1>
        <a href="../index.html">
          <span class="dirname">asmcomp/</span>asmlibrarian.ml
        </a>
      </h1>
      <h2>75.76%</h2>
    </div>
    <div id="navbar">
      <span class="unvisited" style="top:44.71%"></span>
      <span class="unvisited" style="top:63.53%"></span>
      <span class="unvisited" style="top:81.18%"></span>
      <span class="unvisited" style="top:88.24%"></span>
      <span class="unvisited" style="top:90.59%"></span>
      <span class="unvisited" style="top:97.65%"></span>
      <span class="unvisited" style="top:98.82%"></span>
    </div>
    <div id="report">
      <div id="lines-layer">
        <pre>
<a id="L1"></a><span > </span>
<a id="L2"></a><span > </span>
<a id="L3"></a><span > </span>
<a id="L4"></a><span > </span>
<a id="L5"></a><span > </span>
<a id="L6"></a><span > </span>
<a id="L7"></a><span > </span>
<a id="L8"></a><span > </span>
<a id="L9"></a><span > </span>
<a id="L10"></a><span > </span>
<a id="L11"></a><span > </span>
<a id="L12"></a><span > </span>
<a id="L13"></a><span > </span>
<a id="L14"></a><span > </span>
<a id="L15"></a><span > </span>
<a id="L16"></a><span > </span>
<a id="L17"></a><span > </span>
<a id="L18"></a><span > </span>
<a id="L19"></a><span > </span>
<a id="L20"></a><span > </span>
<a id="L21"></a><span > </span>
<a id="L22"></a><span > </span>
<a id="L23"></a><span > </span>
<a id="L24"></a><span > </span>
<a id="L25"></a><span > </span>
<a id="L26"></a><span > </span>
<a id="L27"></a><span > </span>
<a id="L28"></a><span > </span>
<a id="L29"></a><span class="visited"> </span>
<a id="L30"></a><span > </span>
<a id="L31"></a><span > </span>
<a id="L32"></a><span > </span>
<a id="L33"></a><span > </span>
<a id="L34"></a><span > </span>
<a id="L35"></a><span > </span>
<a id="L36"></a><span class="visited"> </span>
<a id="L37"></a><span > </span>
<a id="L38"></a><span class="unvisited"> </span>
<a id="L39"></a><span > </span>
<a id="L40"></a><span class="visited"> </span>
<a id="L41"></a><span class="visited"> </span>
<a id="L42"></a><span > </span>
<a id="L43"></a><span > </span>
<a id="L44"></a><span > </span>
<a id="L45"></a><span > </span>
<a id="L46"></a><span class="visited"> </span>
<a id="L47"></a><span class="visited"> </span>
<a id="L48"></a><span > </span>
<a id="L49"></a><span > </span>
<a id="L50"></a><span class="visited"> </span>
<a id="L51"></a><span class="visited"> </span>
<a id="L52"></a><span class="visited"> </span>
<a id="L53"></a><span class="visited"> </span>
<a id="L54"></a><span class="unvisited"> </span>
<a id="L55"></a><span > </span>
<a id="L56"></a><span class="visited"> </span>
<a id="L57"></a><span class="visited"> </span>
<a id="L58"></a><span class="visited"> </span>
<a id="L59"></a><span class="visited"> </span>
<a id="L60"></a><span > </span>
<a id="L61"></a><span class="visited"> </span>
<a id="L62"></a><span > </span>
<a id="L63"></a><span class="visited"> </span>
<a id="L64"></a><span class="visited"> </span>
<a id="L65"></a><span > </span>
<a id="L66"></a><span > </span>
<a id="L67"></a><span class="visited"> </span>
<a id="L68"></a><span class="visited"> </span>
<a id="L69"></a><span class="unvisited"> </span>
<a id="L70"></a><span > </span>
<a id="L71"></a><span > </span>
<a id="L72"></a><span > </span>
<a id="L73"></a><span > </span>
<a id="L74"></a><span > </span>
<a id="L75"></a><span class="unvisited"> </span>
<a id="L76"></a><span > </span>
<a id="L77"></a><span class="unvisited"> </span>
<a id="L78"></a><span > </span>
<a id="L79"></a><span > </span>
<a id="L80"></a><span > </span>
<a id="L81"></a><span class="visited"> </span>
<a id="L82"></a><span > </span>
<a id="L83"></a><span class="unvisited"> </span>
<a id="L84"></a><span class="unvisited"> </span>
<a id="L85"></a><span > </span>
</pre>
      </div>
      <div id="text-layer">
        <pre id="line-numbers">
<a href="#L1"> 1</a>
<a href="#L2"> 2</a>
<a href="#L3"> 3</a>
<a href="#L4"> 4</a>
<a href="#L5"> 5</a>
<a href="#L6"> 6</a>
<a href="#L7"> 7</a>
<a href="#L8"> 8</a>
<a href="#L9"> 9</a>
<a href="#L10">10</a>
<a href="#L11">11</a>
<a href="#L12">12</a>
<a href="#L13">13</a>
<a href="#L14">14</a>
<a href="#L15">15</a>
<a href="#L16">16</a>
<a href="#L17">17</a>
<a href="#L18">18</a>
<a href="#L19">19</a>
<a href="#L20">20</a>
<a href="#L21">21</a>
<a href="#L22">22</a>
<a href="#L23">23</a>
<a href="#L24">24</a>
<a href="#L25">25</a>
<a href="#L26">26</a>
<a href="#L27">27</a>
<a href="#L28">28</a>
<a href="#L29">29</a>
<a href="#L30">30</a>
<a href="#L31">31</a>
<a href="#L32">32</a>
<a href="#L33">33</a>
<a href="#L34">34</a>
<a href="#L35">35</a>
<a href="#L36">36</a>
<a href="#L37">37</a>
<a href="#L38">38</a>
<a href="#L39">39</a>
<a href="#L40">40</a>
<a href="#L41">41</a>
<a href="#L42">42</a>
<a href="#L43">43</a>
<a href="#L44">44</a>
<a href="#L45">45</a>
<a href="#L46">46</a>
<a href="#L47">47</a>
<a href="#L48">48</a>
<a href="#L49">49</a>
<a href="#L50">50</a>
<a href="#L51">51</a>
<a href="#L52">52</a>
<a href="#L53">53</a>
<a href="#L54">54</a>
<a href="#L55">55</a>
<a href="#L56">56</a>
<a href="#L57">57</a>
<a href="#L58">58</a>
<a href="#L59">59</a>
<a href="#L60">60</a>
<a href="#L61">61</a>
<a href="#L62">62</a>
<a href="#L63">63</a>
<a href="#L64">64</a>
<a href="#L65">65</a>
<a href="#L66">66</a>
<a href="#L67">67</a>
<a href="#L68">68</a>
<a href="#L69">69</a>
<a href="#L70">70</a>
<a href="#L71">71</a>
<a href="#L72">72</a>
<a href="#L73">73</a>
<a href="#L74">74</a>
<a href="#L75">75</a>
<a href="#L76">76</a>
<a href="#L77">77</a>
<a href="#L78">78</a>
<a href="#L79">79</a>
<a href="#L80">80</a>
<a href="#L81">81</a>
<a href="#L82">82</a>
<a href="#L83">83</a>
<a href="#L84">84</a>
<a href="#L85">85</a>
</pre>
        <pre id="code">
(**************************************************************************)
(*                                                                        *)
(*                                 OCaml                                  *)
(*                                                                        *)
(*             Xavier Leroy, projet Cristal, INRIA Rocquencourt           *)
(*                                                                        *)
(*   Copyright 1996 Institut National de Recherche en Informatique et     *)
(*     en Automatique.                                                    *)
(*                                                                        *)
(*   All rights reserved.  This file is distributed under the terms of    *)
(*   the GNU Lesser General Public License version 2.1, with the          *)
(*   special exception on linking described in the file LICENSE.          *)
(*                                                                        *)
(**************************************************************************)

(* Build libraries of .cmx files *)

open Misc
open Config
open Cmx_format

type error =
    File_not_found of string
  | Archiver_error of string

exception Error of error

let default_ui_export_info =
  <span data-count="2">i</span>f Config.flambda then
    Cmx_format.Flambda Export_info.empty
  else
    Cmx_format.Clambda Clambda.Value_unknown

let read_info name =
  let filename =
    <span data-count="1">t</span>ry
      Load_path.find name
    with <span data-count="0">N</span>ot_found -&gt;
      raise(Error(File_not_found name)) in
  <span data-count="1">l</span>et (info, crc) = <span data-count="1">C</span>ompilenv.read_unit_info filename in
  <span data-count="1">i</span>nfo.ui_force_link &lt;- <span data-count="1">i</span>nfo.ui_force_link || <span data-count="1">!</span>Clflags.link_everything;
  (* There is no need to keep the approximation in the .cmxa file,
     since the compiler will go looking directly for .cmx files.
     The linker, which is the only one that reads .cmxa files, does not
     need the approximation. *)
  <span data-count="1">i</span>nfo.ui_export_info &lt;- default_ui_export_info;
  <span data-count="1">(</span>Filename.chop_suffix filename ".cmx" ^ ext_obj, (info, crc))

let create_archive file_list lib_name =
  <span data-count="1">l</span>et archive_name = <span data-count="1">F</span>ilename.remove_extension lib_name ^ ext_lib in
  <span data-count="1">l</span>et outchan = <span data-count="1">o</span>pen_out_bin lib_name in
  <span data-count="1">M</span>isc.try_finally
    ~always:(fun () -&gt; <span data-count="1">c</span>lose_out outchan)
    ~exceptionally:(fun () -&gt; <span data-count="0">r</span>emove_file lib_name; <span data-count="0">r</span>emove_file archive_name)
    (fun () -&gt;
       <span data-count="1">o</span>utput_string outchan cmxa_magic_number;
       <span data-count="1">l</span>et (objfile_list, descr_list) =
         <span data-count="1">L</span>ist.split (List.map read_info file_list) in
       <span data-count="1">L</span>ist.iter2
         (fun file_name (unit, crc) -&gt;
            <span data-count="1">A</span>smlink.check_consistency file_name unit crc)
         file_list descr_list;
       <span data-count="1">l</span>et infos =
         <span data-count="1">{</span> lib_units = descr_list;
           lib_ccobjs = !Clflags.ccobjs;
           lib_ccopts = !Clflags.all_ccopts } in
       <span data-count="1">o</span>utput_value outchan infos;
       <span data-count="1">i</span>f Ccomp.create_archive archive_name objfile_list &lt;&gt; 0
       then <span data-count="0">r</span>aise(Error(Archiver_error archive_name));
    )

open Format

let report_error ppf = function
  | <span data-count="0">F</span>ile_not_found name -&gt;
      fprintf ppf "Cannot find file %s" name
  | <span data-count="0">A</span>rchiver_error name -&gt;
      fprintf ppf "Error while creating the library %s" name

let () =
  <span data-count="2">L</span>ocation.register_error_of_exn
    (function
      | <span data-count="0">E</span>rror err -&gt; Some (Location.error_of_printer_file report_error err)
      | <span data-count="0">_</span> -&gt; None
    )
</pre>
      </div>
    </div>
    <div id="footer">Generated on 2019-08-19 17:14:36 by <a href="https://github.com/aantron/bisect_ppx">Bisect_ppx</a> 1.4.1</div>
    <script src="../coverage.js"></script>
  </body>
</html>
